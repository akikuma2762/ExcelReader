# Excel 格式保留功能說明

## 🎯 新增功能

您的Excel讀取器現在已升級，具備完整的格式保留功能！

### ✨ 主要改進

1. **完整格式保留**
   - 保留儲存格的原始數值和格式化顯示文字
   - 維持Excel的數字格式、日期格式、貨幣格式等
   - 保留字體樣式（粗體、大小、顏色）
   - 保留背景顏色設定

2. **多工作表支援**
   - 顯示所有可用的工作表名稱
   - 支援指定工作表讀取
   - 新增專用API端點 `/api/excel/upload-worksheet`

3. **增強的資料類型識別**
   - 自動識別：文字、數字、整數、日期時間、布林值
   - 為不同資料類型提供視覺化標示
   - 提供詳細的儲存格資訊工具提示

## 📊 資料結構

### 新的ExcelCellInfo格式
每個儲存格現在包含以下資訊：
```json
{
  "Value": "原始值（數字、日期等）",
  "DisplayText": "Excel格式化後的顯示文字",
  "FormatCode": "Excel數字格式代碼",
  "DataType": "資料類型（Number, DateTime, Text等）",
  "FontBold": true,
  "FontSize": 12,
  "FontName": "Arial",
  "BackgroundColor": "FFFF00",
  "FontColor": "000000"
}
```

## 🔧 API 端點

### 新增端點
- `POST /api/excel/upload-worksheet?worksheetName=工作表名稱`
- `POST /api/excel/upload-worksheet?worksheetIndex=0`

### 現有端點（已升級）
- `POST /api/excel/upload` - 現在返回完整格式資訊
- `GET /api/excel/sample` - 提供範例資料
- `GET /api/excel/download-sample` - 下載範例檔案

## 🎨 前端顯示功能

### 格式化顯示
- **顏色標示**：不同資料類型有不同顏色
  - 🔵 日期：藍色
  - 🟢 數字：綠色，靠右對齊
  - 🔴 布林值：紅色，置中
  - ⚪ 空值：灰色背景，斜體
  - ⚫ 文字：黑色

### 互動功能
- **格式資訊切換**：顯示/隱藏Excel格式代碼
- **顯示模式切換**：
  - 預設：顯示Excel格式化文字
  - 原始值：顯示原始數據值
- **工具提示**：滑鼠懸停顯示完整儲存格資訊

## 📋 使用範例

### 1. 上傳Excel並保留格式
```javascript
// 自動處理格式化數字
輸入：123456.789
格式碼：#,##0.00
顯示：123,456.79

// 自動處理日期格式
輸入：2023-12-25
格式碼：yyyy/mm/dd
顯示：2023/12/25
```

### 2. 指定工作表讀取
```javascript
// 使用工作表名稱
POST /api/excel/upload-worksheet?worksheetName=銷售資料

// 使用索引（第一個工作表=0）
POST /api/excel/upload-worksheet?worksheetIndex=1
```

## 🎯 格式保留的優勢

### 之前 vs 現在

**之前**：
- 只能取得基本數值
- 日期變成字串
- 失去數字格式
- 無法識別資料類型

**現在**：
- ✅ 保留Excel原始格式
- ✅ 維持數字、日期、貨幣格式
- ✅ 保留字體樣式和顏色
- ✅ 智慧型資料類型識別
- ✅ 支援多工作表

### 實際應用場景

1. **財務報表**：保留貨幣格式、千分位符號
2. **日期資料**：維持各種日期顯示格式
3. **統計數據**：保留百分比、小數位數設定
4. **格式化表格**：維持Excel的視覺樣式

## 🔍 除錯與驗證

### 查看原始資料
- 勾選「顯示原始值」查看Excel儲存的實際數值
- 勾選「顯示格式信息」查看Excel格式代碼

### 工具提示資訊
滑鼠懸停在任何儲存格上可查看：
- 資料類型
- Excel格式代碼
- 原始值
- 格式化顯示文字

## 🚀 測試建議

1. **建立測試Excel**：
   - 包含各種資料類型
   - 設定不同的數字格式
   - 使用日期、時間格式
   - 添加字體樣式

2. **測試多工作表**：
   - 上傳包含多個工作表的Excel
   - 測試指定工作表讀取功能

3. **驗證格式保留**：
   - 比對Excel原始顯示與網頁顯示
   - 測試格式化數字的正確性
   - 確認日期格式保持一致

---

🎉 **您的Excel讀取器現在已具備企業級的格式保留功能！**